---
 texmf-dist/tex/latex/pdftex-def/pdftex.def |   37 +++++++++++++++++++++++++++--
 1 file changed, 35 insertions(+), 2 deletions(-)

Index: texlive-base-2009/texmf-dist/tex/latex/pdftex-def/pdftex.def
===================================================================
--- texlive-base-2009.orig/texmf-dist/tex/latex/pdftex-def/pdftex.def	2009-08-27 08:59:45.000000000 +0900
+++ texlive-base-2009/texmf-dist/tex/latex/pdftex-def/pdftex.def	2010-03-11 23:10:41.000000000 +0900
@@ -1,4 +1,4 @@
-\ProvidesFile{pdftex.def}[2009/08/25 v0.04m Graphics/color for pdfTeX]
+\ProvidesFile{pdftex.def}[2010/03/12 v0.04p Graphics/color for pdfTeX]
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %%
 %% LaTeX Colour and Graphics support for PDFTeX
@@ -6,7 +6,7 @@
 %% License
 %% =======
 %%
-%% Copyright (C) 2000-2009 David Carlisle, Sebastian Rahtz, Hans Hagen,
+%% Copyright (C) 2000-2010 David Carlisle, Sebastian Rahtz, Hans Hagen,
 %% Heiko Oberdiek and Martin Schr\"oder
 %%
 %% This work may be distributed and/or modified under the
@@ -187,6 +187,15 @@
 %    pdftex.def and ConTeXt's support files.
 %  * ConTeXt's support files have now the extension `.mkii' instead
 %    of `.tex'.
+% 2010/02/14 v0.04n (HO)
+%  * \GPT@catcodes extended for xmlTeX (pdftex.def loads
+%    supp-pdf.mkii at begin document where xmlTeX's catcodes
+%    are already active).
+% 2010/03/11 v0.04o (HO)
+%  * Ensure that \undefined is undefined during loading of
+%    ConTeXt files.
+% 2010/03/12 v0.04p (HO)
+%  * \undefined is also undefined during conversion of MPS.
 %
 % Prefix of internal commands for this file `pdftex.def':
 %   \GPT@ (Graphics bundle PdfTex driver)
@@ -201,6 +210,14 @@
 \catcode64 11 % @
 \def\GPT@catcodes#1{%
   \expandafter\edef\csname GPT@restore@#1\endcsname{%
+    \let\noexpand\undefined
+        \expandafter\noexpand\csname GPTorg@#1@undefined\endcsname
+    \let\expandafter\noexpand\csname GPTorg@#1@undefined\endcsname
+        \noexpand\@undefined
+    \endlinechar \the\endlinechar
+    \catcode9 \the\catcode9 % tab
+    \catcode13 \the\catcode13 % ^^M
+    \catcode32 \the\catcode32 % space
     \catcode33 \the\catcode33 % !
     \catcode34 \the\catcode34 % "
     \catcode35 \the\catcode35 % #
@@ -224,15 +241,22 @@
     \catcode63 \the\catcode63 % ?
     \catcode64 \the\catcode64 % @
     \catcode91 \the\catcode91 % [
+    \catcode92 \the\catcode92 % \
     \catcode93 \the\catcode93 % ]
     \catcode94 \the\catcode94 % ^
     \catcode95 \the\catcode95 % _
     \catcode96 \the\catcode96 % `
+    \catcode123 \the\catcode123 % {
     \catcode124 \the\catcode124 % |
+    \catcode125 \the\catcode125 % }
     \catcode126 \the\catcode126 % ~
   }%
+  \endlinechar 13 %
+  \catcode9 10 % tab
+  \catcode13 5 % ^^M (end of line)
   \catcode64 11 %
   \catcode61 12 % =
+  \catcode32 10 % space
   \catcode33 12 % !
   \catcode34 12 % "
   \catcode35 6 % #
@@ -256,12 +280,17 @@
   \catcode63 12 % ?
   \catcode64 11 % @
   \catcode91 12 % [
+  \catcode92 0 % \
   \catcode93 12 % ]
   \catcode94 7 % ^
   \catcode95 8 % _
   \catcode96 12 % `
+  \catcode123 1 % {
   \catcode124 12 % |
+  \catcode125 2 % }
   \catcode126 13 % ~
+  \expandafter\let\csname GPTorg@#1@undefined\endcsname\undefined
+  \let\undefined\@undefined
 }
 \GPT@catcodes{}
 
@@ -1125,7 +1154,9 @@
           \hskip-\Gin@vllx bp\relax
         \fi
       \fi
+      \GPT@catcodes{mps}%
       \convertMPtoPDF{#1}{1}{1}%
+      \GPT@restore@mps
       \ifGPT@viewport
         \ifdim\Gin@vlly\p@=\z@
         \else
@@ -1167,8 +1198,10 @@
       \ifx\Gin@scalex\@tempa\let\Gin@scalex\Gin@scaley\fi
     \fi
     \hbox{%
+      \GPT@catcodes{pdf}%
       \convertPDFtoPDF{#1}{\Gin@scalex}{\Gin@scaley} {0bp} {0bp}%
       {\Gin@req@width}{\Gin@req@height}%
+      \GPT@restore@pdf
     }%
   }%
 \fi
